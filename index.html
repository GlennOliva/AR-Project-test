<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Cake WebXR AR</title>

    <!-- âœ… Only ONE A-Frame build -->
<script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>

<!-- âœ… Your hit-test/light-estimation helper -->
<script src="https://cdn.jsdelivr.net/gh/chenzlabs/aframe-xr@main/aframe-xr-hit-test.js"></script>

    <style>
      html,body { margin:0; height:100%; overflow:hidden; }
      a-scene { width:100vw; height:100vh; }
    </style>
  </head>
  <body>
    <!-- ðŸ”¹ WebXR AR Scene -->
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      xrweb="mode: ar; optionalFeatures: hit-test, light-estimation;"
       renderer="colorManagement: true; physicallyCorrectLights: true">
      
      <!-- Real-world camera + hit test reticle -->
      <a-entity id="reticle"
                geometry="primitive: ring; radiusInner:0.08; radiusOuter:0.1"
                material="color: yellow; shader: flat; opacity:0.8"
                xr-hit-test="target:#cakeModel; autoPlace: false"
                visible="false">
      </a-entity>

      <!-- Cake model (initially invisible until placed) -->
      <a-entity id="cakeModel"
                visible="false"
                scale="3 3 3"
                gltf-model="url(assets/cake.glb)">
      </a-entity>

      <!-- Environment light estimation -->
      <a-light type="ambient" intensity="1" xr-light-estimation></a-light>

      <a-camera></a-camera>
    </a-scene>

<script>
  const scene = document.querySelector('a-scene');
  const cake  = document.querySelector('#cakeModel');
  const reticle = document.querySelector('#reticle');

  // Wait until the scene is fully initialized
  scene.addEventListener('loaded', () => {
    scene.renderer.outputEncoding = THREE.sRGBEncoding;
  });

  scene.addEventListener('click', () => {
    if (reticle.visible) {
      // Place the cake where the reticle is
      cake.setAttribute('position', reticle.getAttribute('position'));
      cake.setAttribute('rotation', reticle.getAttribute('rotation'));
      cake.setAttribute('visible', 'true');
    }
  });
</script>

  </body>
</html>
